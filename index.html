<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feel Understood - Self Assessment</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial; background: #fff; color: #121212; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const App = () => {
      const [step, setStep] = React.useState(-1);
      const [responses, setResponses] = React.useState({});
      const [showResults, setShowResults] = React.useState(false);
      const [aiAnalysis, setAiAnalysis] = React.useState(null);
      const [isGenerating, setIsGenerating] = React.useState(false);
      
      const questions = [
        {
          id: 'general',
          text: 'When you consider the totality of your relationships, how accurately would you say people understand who you fundamentally are?',
          options: ['People see me with remarkable clarity', 'Most people understand the essential me', 'There is a noticeable gap between who I am and how I am perceived', 'I am frequently misunderstood in important ways', 'I feel profoundly unseen by those around me']
        },
        {
          id: 'frequency',
          text: 'In conversations that matter to you, how often do you experience that satisfying moment when someone truly gets what you are trying to communicate?',
          options: ['Almost always, it is a regular experience', 'Often enough that I count on it', 'Occasionally, but it feels special when it happens', 'Rarely, it is notable when someone understands', 'Almost never, I have largely stopped expecting it']
        },
        {
          id: 'support',
          type: 'multi',
          text: 'Which relationships in your life consistently provide you with a sense of being genuinely understood?',
          sub: 'Select all where you regularly feel seen and comprehended',
          options: ['Romantic partner or spouse', 'Parents or parental figures', 'Siblings', 'Close friends in person', 'Colleagues or work relationships', 'Online communities or virtual friendships', 'Therapist or counsellor', 'Extended family members', 'None of the above apply to me']
        },
        {
          id: 'context',
          text: 'In which domain of your life do you most acutely feel the absence of understanding, where the gap between your inner experience and others perceptions feels widest?',
          options: ['Professional life, my capabilities and contributions go unrecognised', 'Home and family, those closest to me misread who I am', 'Social settings, friends do not grasp my perspective', 'Intimate relationships, my partner does not see the real me', 'Community or public contexts, I am misunderstood by society at large', 'The gap feels relatively consistent across all domains']
        },
        {
          id: 'positive',
          type: 'multi',
          text: 'When someone demonstrates genuine understanding of you, what shifts in your experience?',
          sub: 'Select all that resonate with your actual experience',
          options: ['I feel psychologically safer and more willing to be vulnerable', 'The relationship deepens, I feel genuinely connected', 'My self-doubt diminishes, I trust my own perceptions more', 'I experience relief from the isolation of being alone with my thoughts', 'I become more authentic and less self-monitoring', 'I feel valued and respected as a person', 'My stress and anxiety levels decrease noticeably', 'Honestly, it does not create significant change for me']
        },
        {
          id: 'negative',
          type: 'multi',
          text: 'When you are misunderstood in ways that matter, what are the consequences in your inner life and behaviour?',
          sub: 'Select all that accurately describe your response',
          options: ['I withdraw emotionally and become less forthcoming', 'I question my own perceptions and experience self-doubt', 'I feel frustrated or angry at not being seen', 'The relationship loses intimacy and feels more superficial', 'I experience a sense of loneliness even when not alone', 'I feel disrespected or diminished as a person', 'My mental wellbeing deteriorates, increased anxiety or low mood', 'I become more defensive in future interactions', 'I actively distance myself from the relationship', 'It does not significantly impact me, I move on easily']
        },
        {
          id: 'values',
          type: 'rating',
          text: 'Your values, beliefs, and worldview',
          sub: 'Consider how well others understand your political views, spiritual or religious beliefs, ethical principles, what truly matters to you, and how you make sense of the world. To what degree do you feel misunderstood in this dimension of your identity?'
        },
        {
          id: 'personality',
          type: 'rating',
          text: 'Your personality and emotional nature',
          sub: 'Think about whether people grasp your temperament, your emotional needs, how you process experiences, your sense of humour, what energises or drains you, and your characteristic way of engaging with life. How misunderstood do you feel here?'
        },
        {
          id: 'preferences',
          type: 'rating',
          text: 'Your preferences and lifestyle choices',
          sub: 'Reflect on how others perceive your interests, passions, aesthetic tastes, social needs, how much interaction you want and need, and how you choose to spend your time and energy. Rate your sense of being misunderstood in this area.'
        },
        {
          id: 'motivations',
          type: 'rating',
          text: 'Your aspirations and what drives you',
          sub: 'Consider whether people comprehend your ambitions, career goals, personal aspirations, what motivates you daily, your creative impulses, and what you are ultimately working toward in life. How misunderstood are you here?'
        },
        {
          id: 'struggles',
          type: 'rating',
          text: 'Your challenges, vulnerabilities, and inner struggles',
          sub: 'Think about how well others understand your mental health experiences, physical health challenges, past experiences that have shaped you, your fears and anxieties, and what you find genuinely difficult. Rate the degree of misunderstanding.'
        },
        {
          id: 'capabilities',
          type: 'rating',
          text: 'Your capabilities and potential',
          sub: 'Reflect on whether people accurately perceive your abilities, skills, intelligence, potential for growth, and what you are truly capable of contributing. How misunderstood do you feel in this dimension?'
        },
        {
          id: 'responsibility',
          text: 'When you are not understood, where do you typically locate the responsibility?',
          sub: 'This reveals your implicit theory about how understanding works',
          options: ['Primarily my responsibility, I need to communicate more effectively', 'Mostly my responsibility, though context matters', 'Shared responsibility between both parties', 'Mostly the other person responsibility to listen better', 'Primarily their responsibility, if they cared, they would understand']
        },
        {
          id: 'expression',
          text: 'When you do not feel understood in a conversation, how often do you explicitly name this, saying something like I do not feel understood right now?',
          options: ['Regularly, it is part of how I communicate', 'Sometimes, when it really matters', 'Rarely, only in specific relationships or circumstances', 'Almost never, it feels too vulnerable or confrontational', 'Never, I keep that feeling to myself']
        },
        {
          id: 'awareness',
          text: 'How often do you discover that someone you thought understood you actually held significant misconceptions about who you are or what you meant?',
          sub: 'This assesses your awareness of false positives in understanding',
          options: ['Very frequently, it is a recurring pattern', 'Fairly often, it happens regularly enough to notice', 'Occasionally, it surprises me when it occurs', 'Rarely, my sense of being understood is usually accurate', 'Almost never, people generally understand me as I perceive']
        }
      ];
      
      const handleAnswer = (qid, val) => {
        setResponses({...responses, [qid]: val});
      };
      
      const handleMulti = (qid, opt) => {
        const curr = responses[qid] || [];
        const has = curr.includes(opt);
        const updated = has ? curr.filter(x => x !== opt) : [...curr, opt];
        setResponses({...responses, [qid]: updated});
      };
      
      const generateAIAnalysis = async () => {
        setIsGenerating(true);
        
        const prompt = `You are analyzing responses from a "Feeling Understood" self-assessment survey. Based on the person's answers, provide a comprehensive, personalized analysis of their experience with being understood and misunderstood.

SURVEY RESPONSES:

General Understanding: ${responses.general}
Frequency of Being Understood: ${responses.frequency}
Support Network: ${(responses.support || []).join(', ')}
Most Misunderstood Context: ${responses.context}
Positive Effects Selected: ${(responses.positive || []).join(', ')}
Negative Effects Selected: ${(responses.negative || []).join(', ')}

Identity Dimension Ratings (1-10 scale, where 10 = extremely misunderstood):
- Values and Beliefs: ${responses.values || 'Not answered'}/10
- Personality and Emotional Nature: ${responses.personality || 'Not answered'}/10
- Preferences and Lifestyle: ${responses.preferences || 'Not answered'}/10
- Aspirations and Motivations: ${responses.motivations || 'Not answered'}/10
- Challenges and Vulnerabilities: ${responses.struggles || 'Not answered'}/10
- Capabilities and Potential: ${responses.capabilities || 'Not answered'}/10

Communication Patterns:
- Responsibility for Being Understood: ${responses.responsibility}
- Frequency of Expressing Lack of Understanding: ${responses.expression}
- Awareness of False Positives: ${responses.awareness}

ANALYSIS REQUIREMENTS:

1. Write a comprehensive, personalized analysis (800-1200 words) that:
   - Identifies unique patterns in their responses
   - Highlights which identity dimensions are most/least understood
   - Connects their communication patterns to their experience
   - Explores the context where they feel most misunderstood
   - Analyzes the impact (positive and negative effects they selected)
   - Provides specific, actionable insights

2. Structure as flowing prose with clear sections:
   - Overall Pattern (2-3 paragraphs)
   - Identity Dimensions Analysis (2-3 paragraphs)
   - Communication and Relationships (2 paragraphs)
   - Key Insights and Recommendations (2-3 paragraphs)

3. Tone: Empathetic, insightful, psychologically informed but accessible
4. Avoid generic advice - make it specific to THEIR pattern of responses
5. Use "you" language - write directly to them
6. No bullet points - write in cohesive paragraphs

Generate the analysis now:`;

        try {
          const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              system: 'You are an expert psychologist analyzing self-assessment survey results about feeling understood. Provide deep, personalized insights based on response patterns.',
              messages: [{ role: 'user', content: prompt }]
            })
          });

          const data = await response.json();
          const analysis = data.content
            .filter(item => item.type === 'text')
            .map(item => item.text)
            .join('\n');

          setAiAnalysis(analysis);
        } catch (error) {
          console.error('Error generating analysis:', error);
          setAiAnalysis('We encountered an issue generating your personalized analysis. Please try again.');
        } finally {
          setIsGenerating(false);
        }
      };
      
      const handleComplete = async () => {
        setShowResults(true);
        await generateAIAnalysis();
      };
      
      if (step === -1) {
        return (
          <div style={{minHeight: '100vh', padding: '40px 20px'}}>
            <div style={{maxWidth: '700px', margin: '0 auto', textAlign: 'center'}}>
              <h1 style={{fontSize: '36px', fontWeight: 'bold', marginBottom: '12px'}}>The Understanding Gap</h1>
              <p style={{fontSize: '18px', color: '#999b9b', marginBottom: '24px'}}>A comprehensive self-assessment</p>
              <p style={{fontSize: '16px', lineHeight: 1.8, marginBottom: '40px', textAlign: 'left'}}>
                Feeling understood is fundamental to human wellbeing. It shapes our relationships, influences our mental health, and forms the foundation of our sense of belonging. This assessment examines the gap between who you are and how others perceive you, revealing where understanding flourishes and where it fails. Your responses will illuminate patterns in your communication and relationships that may be invisible to you in daily life.
              </p>
              <button onClick={() => setStep(0)} style={{padding: '16px 36px', backgroundColor: '#ffd21f', border: 'none', borderRadius: '8px', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer'}}>
                Begin Assessment
              </button>
            </div>
          </div>
        );
      }
      
      if (showResults) {
        return (
          <div style={{minHeight: '100vh', padding: '40px 20px'}}>
            <div style={{maxWidth: '900px', margin: '0 auto'}}>
              <h1 style={{fontSize: '36px', fontWeight: 'bold', marginBottom: '20px', textAlign: 'center'}}>Your Understanding Profile</h1>
              <p style={{fontSize: '18px', color: '#999b9b', marginBottom: '40px', textAlign: 'center'}}>A personalized analysis generated by AI</p>
              
              <div style={{border: '2px solid #e5e5e5', borderRadius: '8px', padding: '48px', marginBottom: '24px', minHeight: '400px'}}>
                {isGenerating ? (
                  <div style={{textAlign: 'center', padding: '60px 20px'}}>
                    <div style={{marginBottom: '20px'}}>
                      <div style={{display: 'inline-block', width: '50px', height: '50px', border: '5px solid #e5e5e5', borderTop: '5px solid #ffd21f', borderRadius: '50%', animation: 'spin 1s linear infinite'}}></div>
                    </div>
                    <p style={{fontSize: '18px', color: '#121212', marginBottom: '8px'}}>Analyzing your responses...</p>
                    <p style={{fontSize: '14px', color: '#999b9b'}}>Our AI is generating your personalized insights</p>
                  </div>
                ) : aiAnalysis ? (
                  <div style={{fontSize: '16px', lineHeight: 1.8, color: '#121212', whiteSpace: 'pre-wrap'}}>
                    {aiAnalysis}
                  </div>
                ) : (
                  <p>Analysis could not be generated. Please try again.</p>
                )}
              </div>
              
              <style>{`
                @keyframes spin {
                  0% { transform: rotate(0deg); }
                  100% { transform: rotate(360deg); }
                }
              `}</style>
              
              <button onClick={() => window.location.reload()} style={{padding: '16px 36px', backgroundColor: '#ffd21f', border: 'none', borderRadius: '8px', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer'}}>
                Retake Assessment
              </button>
            </div>
          </div>
        );
      }
      
      const q = questions[step];
      const prog = ((step + 1) / questions.length) * 100;
      const canNext = responses[q.id] !== undefined;
      
      return (
        <div style={{minHeight: '100vh', padding: '40px 20px'}}>
          <div style={{maxWidth: '900px', margin: '0 auto'}}>
            <div style={{height: '4px', backgroundColor: '#e5e5e5', marginBottom: '40px'}}>
              <div style={{height: '100%', backgroundColor: '#ffd21f', width: prog + '%', transition: 'width 0.3s'}} />
            </div>
            
            <div style={{border: '2px solid #e5e5e5', borderRadius: '8px', padding: '48px', marginBottom: '24px'}}>
              <h2 style={{fontSize: '22px', fontWeight: 'bold', marginBottom: '12px', lineHeight: 1.5}}>{q.text}</h2>
              {q.sub && <p style={{fontSize: '15px', color: '#999b9b', marginBottom: '36px', lineHeight: 1.6, fontStyle: 'italic'}}>{q.sub}</p>}
              
              {q.type === 'rating' ? (
                <div>
                  <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap', justifyContent: 'center', marginTop: '8px'}}>
                    {[1,2,3,4,5,6,7,8,9,10].map(num => (
                      <button
                        key={num}
                        onClick={() => handleAnswer(q.id, num)}
                        style={{
                          width: '64px',
                          height: '64px',
                          backgroundColor: responses[q.id] === num ? '#ffd21f' : '#fff',
                          border: responses[q.id] === num ? '2px solid #121212' : '2px solid #e5e5e5',
                          borderRadius: '8px',
                          fontSize: '22px',
                          fontWeight: 'bold',
                          cursor: 'pointer'
                        }}
                      >
                        {num}
                      </button>
                    ))}
                  </div>
                  <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '16px', fontSize: '13px', color: '#999b9b'}}>
                    <span>Not misunderstood at all</span>
                    <span>Extremely misunderstood</span>
                  </div>
                </div>
              ) : (
                <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                  {q.options.map(opt => {
                    const isSel = q.type === 'multi' ? (responses[q.id] || []).includes(opt) : responses[q.id] === opt;
                    return (
                      <button
                        key={opt}
                        onClick={() => q.type === 'multi' ? handleMulti(q.id, opt) : handleAnswer(q.id, opt)}
                        style={{
                          width: '100%',
                          textAlign: 'left',
                          padding: '18px 24px',
                          backgroundColor: isSel ? '#ffd21f' : '#fff',
                          border: isSel ? '2px solid #121212' : '2px solid #e5e5e5',
                          borderRadius: '8px',
                          fontSize: '16px',
                          cursor: 'pointer',
                          lineHeight: 1.5
                        }}
                      >
                        {q.type === 'multi' && <span style={{marginRight: '12px'}}>{isSel ? '✓' : '○'}</span>}
                        {opt}
                      </button>
                    );
                  })}
                </div>
              )}
            </div>
            
            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
              <button onClick={() => setStep(step - 1)} disabled={step === 0} style={{padding: '16px 36px', backgroundColor: '#fff', border: '2px solid #121212', borderRadius: '8px', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer', opacity: step === 0 ? 0.5 : 1}}>
                Previous
              </button>
              <span style={{color: '#999b9b', fontSize: '14px'}}>Question {step + 1} of {questions.length}</span>
              <button onClick={() => step === questions.length - 1 ? handleComplete() : setStep(step + 1)} disabled={!canNext} style={{padding: '16px 36px', backgroundColor: '#ffd21f', border: 'none', borderRadius: '8px', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer', opacity: canNext ? 1 : 0.5}}>
                {step === questions.length - 1 ? 'View Results' : 'Next'}
              </button>
            </div>
          </div>
        </div>
      );
    };
    
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
